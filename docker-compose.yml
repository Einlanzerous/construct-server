
services:
  # --- AI & LLM STACK ---
  ollama:
    image: ollama/ollama:latest
    container_name: ollama
    restart: unless-stopped
    ports:
      - "11434:11434"
    volumes:
      - ./ollama:/root/.ollama
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]

  open-webui:
    image: ghcr.io/open-webui/open-webui:main
    container_name: open-webui
    restart: unless-stopped
    ports:
      - "3000:8080"
    environment:
      - OLLAMA_BASE_URL=${OLLAMA_BASE_URL}
      - DEFAULT_MODELS=gemma3:12b-it-qat
    volumes:
      - ./webui:/app/backend/data
    depends_on:
      - ollama

  # --- FILE SHARING ---
  # copyparty:
  #   image: ucartz/copyparty
  #   container_name: copyparty
  #   restart: unless-stopped
  #   ports:
  #     - "3923:3923"
  #   volumes:
  #     - ./copyparty:/w
  #     # Map your massive storage drive here if you have one
  #     # - /mnt/hdd:/w/hdd 
  #   environment:
  #     - E=idk  # Enable basic drag-and-drop upload

  # --- OBSERVABILITY (Datadog + Dozzle) ---
  datadog:
    image: datadog/agent:7
    container_name: datadog
    pid: host
    environment:
      - DD_API_KEY=${DD_API_KEY}
      - DD_SITE=${DD_SITE}
      - DD_TAGS=${DD_TAGS}
      - DD_DOCKER_LABELS_AS_TAGS=true
      - DD_DOCKER_LISTEN_ON=/var/run/docker.sock
      - DD_PROCESS_AGENT_ENABLED=true
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
      - /proc/:/host/proc/:ro
      - /sys/fs/cgroup/:/host/sys/fs/cgroup:ro
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [gpu, utility]

  dozzle:
    image: amir20/dozzle:latest
    container_name: dozzle
    restart: unless-stopped
    ports:
      - "8080:8080"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock

  # --- DASHBOARD (Homer) ---
  homer:
    image: b4bz/homer
    container_name: homer
    restart: unless-stopped
    ports:
      - "80:8080"
    volumes:
      - ./homer:/www/assets